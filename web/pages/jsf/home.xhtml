<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://struts.apache.org/tags-html">
<h:head>
    <title><h:outputFormat value="#{msgs['home.title']}" /></title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.css" />
    <link rel="stylesheet" href="/gestion_contact/pages/jsf/main.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</h:head>

<h:body style="background-color: #f7f7f7;">

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.js" />
    <script type="text/javascript" src="/gestion_contact/pages/jsf/main.js" />

    <!-- Load contacts and groups on first launch -->
    <f:metadata>
        <f:viewAction action="#{beanManager.loadGroups}"/>
        <f:viewAction action="#{beanManager.loadContacts}"/>
        <f:view locale="#{facesContext.externalContext.requestLocale}"/>
    </f:metadata>

    <!-- navigation bar -->
    <nav>
        <div class="nav-wrapper" style="background-color: #3b5998;">
            <a href="#" class="brand-logo center">
                <h:outputFormat value="#{msgs['home.title']}" />
            </a>
        </div>
    </nav>

    <div class="container">

        <br/>
        <!-- Menu buttons -->
        <div class="row">
            <div class="col s2 offset-s10">
                <div style="position: relative">
                    <div class="fixed-action-btn horizontal" style="position: absolute; right: auto; bottom: auto;">
                        <a class="btn-floating btn-large light-blue darken-4">
                            <i class="material-icons">menu</i>
                        </a>
                        <ul>
                            <li>
                                <h:form>
                                    <h:commandLink action="#{viewManager.enableDisplayCreateGroupForm}"
                                                   styleClass="btn-floating waves-effect waves-light">
                                        <i class="material-icons center">group_add</i>
                                    </h:commandLink>
                                </h:form>
                            </li>
                            <li><a class="btn-floating yellow darken-1" href="#"><i class="material-icons">person_add</i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Put error message in a notification box -->
        <h:messages globalOnly="true" styleClasse="global-error" />
        <br/><br/><br/>

        <!-- Main page display -->
        <div class="row">
            <div class="col s6">
            <div class="card-panel">
            <div style="color: #3b5998;">
                <i class="material-icons">book</i>
                <i class="material-icons prefix">group</i>
            </div>
            <div class="container">
            <div class="row">
            <div class="col s12">

                <!-- Search for group -->
                <h:form id="form-searchGroup">
                    <div class="row">
                        <div class="input-field col s10">
                            <i class="material-icons prefix">search</i>
                            <h:inputText styleClass="validate" id="groupName" value="#{searchGroup.filterGroups}" validatorMessage="#{msgs['search.groupname.validator.size.min.max']}">
                                <f:validateLength maximum="50" />
                            </h:inputText>
                            <h:outputLabel for="groupName">#{msgs['label.search.group']}</h:outputLabel>
                        </div>
                    </div>
                    <h:message for="groupName" styleClass="form-input-error" />
                    <h:commandButton action="#{searchGroup.searchGroupByName}" styleClass="btn waves-effect waves-light postfix" style="display: none;"/>
                </h:form>

                <!-- List of group-->
                <div class="row">
                    <h:dataTable value="#{beanManager.dataManager.displayGroups}" var="group" rendered="#{viewManager.displayGroups}" styleClass="responsive-table highlight bordered">
                        <h:column>
                            <h:form>
                                <h:commandLink  action="#{beanManager.loadGroup(group.groupId)}" style="color: black;">
                                    <h:outputText value="#{group.groupName}"/></h:commandLink>
                            </h:form>
                        </h:column>
                        <h:column>
                            <h:form>
                                <h:commandLink action="#{deleteGroup.deleteGroup(group.groupId)}" styleClass="btn-floating waves-effect waves-light grey left-align" >
                                    <i class="material-icons left-align">remove</i>
                                </h:commandLink>
                            </h:form>
                        </h:column>
                    </h:dataTable>
                </div>

            </div>
            </div>
            </div>
            </div>
            </div>

            <div class="col s6">

                <!-- Display group information (name and list of contacts -->
                <h:panelGroup layout="block" rendered="#{viewManager.displayGroup}">
                    <div class="card-panel">
                    <div class="container">
                    <div class="row">
                        <div class="col s10 center">
                            <h5 class="center">
                                <h:outputText value="#{beanManager.dataManager.group.groupName}"/>
                            </h5>
                        </div>
                        <div class="col s2">
                            <h:form>
                                <h:commandLink action="#{viewManager.enableDisplayUpdateGroupForm}" rendered="#{!viewManager.displayUpdateGroupForm}"
                                               styleClass="btn-floating waves-effect waves-light orange">
                                    <i class="material-icons">mode_edit</i>
                                </h:commandLink>
                            </h:form>
                        </div>
                    </div>

                    <!-- Search for contact in group -->
                    <h:form>
                        <div class="row">
                        <div class="input-field col s10">
                        <i class="material-icons prefix">search</i>
                        <h:inputText id="input-form-searchContactInGroup-name" value="#{searchGroup.filterContacts}" validatorMessage="#{msgs['search.contact.validator.size.min.max']}"
                                     styleClass="validate">
                            <f:validateLength minimum="1" maximum="50" />
                        </h:inputText>
                            <h:outputLabel for="input-form-searchContactInGroup-name">#{msgs['label.search.contact']}</h:outputLabel>
                        </div>
                        <h:commandButton action="#{searchGroup.searchContactByName}" styleClass="btn-floating waves-effect waves-light light-blue darken-4" style="display: none;"/>
                        </div>
                    </h:form>
                    <h:message for="input-form-searchContactInGroup-name" styleClass="form-input-error" />

                    <!-- List of contact in group (by firstname and lastname) -->
                    <div class="row">
                    <h:dataTable value="#{beanManager.dataManager.displayContactsOfGroup}" var="contact" rendered="#{viewManager.displayGroup}" styleClass="responsive-table highlight bordered">
                        <h:column>
                            <h:outputText value="#{contact.firstName} #{contact.lastName}" />
                        </h:column>

                        <!-- Delete Contact in group -->
                        <h:column>
                            <h:form>
                                <h:commandLink action="#{deleteGroup.deleteContactFromGroup(contact.id, beanManager.dataManager.group.groupId)}"
                                               styleClass="btn-floating waves-effect waves-light grey">
                                    <i class="material-icons">remove</i>
                                </h:commandLink>
                            </h:form>
                        </h:column>

                    </h:dataTable>
                    </div>
                    <br/>

                    <!-- Add contact to group -->
                    <div class="row">
                    <h:form>
                        #{addContactToGroup.setGroupId(beanManager.dataManager.group.groupId)}
                        <h:inputHidden value="#{addContactToGroup.groupId}" />
                        <div class="input-field col s6 offset-s2">
                        <h:selectOneMenu value="#{addContactToGroup.contactId}">
                            <f:selectItem itemValue="0" itemDisabled="true" itemLabel="#{msgs['label.select.contact']}" selected="selected" noSelectionOption="true" />
                            <f:selectItems value="#{beanManager.dataManager.contactsNotInGroup}" var="contact" itemValue="#{contact.id}" itemLabel="#{contact.fullName}"/>
                        </h:selectOneMenu>
                            <label>Contact</label>
                        </div>
                        <div class="input-field col s2">
                            <div class="input-field col s12">
                            <h:commandLink action="#{addContactToGroup.addContactToGroup}" styleClass="btn waves-effect waves-light light-blue darken-4">
                                <i class="material-icons">person_add</i>
                            </h:commandLink>
                            </div>
                        </div>
                    </h:form>
                    </div>
                    </div>
                    </div>
                </h:panelGroup>

                <!-- Update group information-->
                <h:panelGroup layout="block" rendered="#{viewManager.displayUpdateGroupForm}">
                    <div class="card-panel">
                    <div class="container">
                    <h5 class="center"><h:outputFormat value="#{msgs['label.update']} #{msgs['label.group']}" /></h5>
                    <h:form id="form-updateGroup">
                        #{updateGroup.setGroupName(beanManager.dataManager.group.groupName)}
                        #{updateGroup.setGroupId(beanManager.dataManager.group.groupId)}
                        <div class="row">
                        <div class="input-field col s10">
                            <i class="material-icons prefix">mode_edit</i>
                            <h:inputText id="updateGroup-groupName" class="validate" value="#{updateGroup.groupName}" validatorMessage="#{msgs['input.groupname.validator.min.max']}">
                                <f:validateLength minimum="3" maximum="50" />
                            </h:inputText>
                            <h:outputLabel for="updateGroup-groupName">#{msgs['label.groupname']}</h:outputLabel>
                        </div>
                        </div>
                        <h:inputHidden value="#{updateGroup.groupId}" />
                        <h:commandButton action="#{updateGroup.updateGroup}" styleClass="btn waves-effect waves-light postfix" style="display: none;"/>
                    </h:form>
                    <h:message for="updateGroup-groupName" styleClass="form-input-error" />
                    <h:message for="form-updateGroup" styleClasse="form-error" />
                    </div>
                    </div>
                </h:panelGroup>

                <!-- Create new group -->
                <h:panelGroup layout="block" rendered="#{viewManager.displayCreateGroupForm}" >
                    <div class="card-panel">
                    <div class="container">
                    <h5 class="center">#{msgs['label.add.contactgroup']}</h5>
                    <h:form id="form-createGroup">
                        <div class="row">
                        <div class="input-field col s10">
                        <h:inputText styleClass="validate" id="createGroup-groupName" value="#{createGroup.groupName}" required="true"
                                     requiredMessage="#{msgs['label.input.required']}" validatorMessage="#{msgs['input.groupname.validator.min.max']}">
                            <f:validateLength minimum="3" maximum="50" />
                        </h:inputText>
                            <h:outputLabel for="createGroup-groupName">#{msgs['label.groupname']}</h:outputLabel>
                        </div>
                        <div class="input-field col s2">
                        <h:commandLink action="#{createGroup.createGroup}" styleClass="btn waves-effect waves-light light-blue darken-4">
                            <i class="material-icons center">group_add</i>
                        </h:commandLink>
                        </div>
                        </div>
                    </h:form>
                    <h:message for="createGroup-groupName" styleClass="error" />
                    <h:message for="form-createGroup" styleClasse="form-error" />
                    </div>
                    </div>
                </h:panelGroup>
            </div>

        </div>

    </div>

    <footer class="page-footer" style="background-color: #3b5998;">
        <div class="container">
            © 2017 Copyright Valentin Bouquet - Rémy Pocquerusse
            <a class="grey-text text-lighten-4 right" href="https://github.com/Remypoc/Gestion-de-contact">github source code</a>
        </div>
    </footer>

</h:body>

</html>
